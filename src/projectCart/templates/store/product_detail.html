{% extends 'base.html' %}
{% load static %}

{% block content %}

<section class="section-content padding-y bg">
    {% include 'includes/alerts.html' %}
    <div class="container">
    
    <!-- ============================ COMPONENT 1 ================================= -->
    <div class="card">
        <div class="row no-gutters">
            <aside class="col-md-6">
                <article class="gallery-wrap"> 
                    <div class="img-big-wrap mainImage">
                    <center><img src="{{single_product.images.url}}"></center>
                    </div> <!-- img-big-wrap.// -->
                    
                </article> <!-- gallery-wrap .end// -->
                <ul class="thumb">
                    <li class="">
                        <a class="ml-3" href="{{single_product.images.url}}" target="mainImage"><img src="{{single_product.images.url}}" alt="Product Image"></a>
                        {% for i in product_gallery %}
                        <a href="{{i.image.url}}" target="mainImage"><img src="{{i.image.url}}" alt="Product Image"></a>
                            
                        {% endfor %}
                    </li>
                </ul>
            </aside>
            <main class="col-md-6 border-left">
                <form action="{% url 'add_cart' single_product.id %}" method="POST">
                    {% csrf_token %}
                    <article class="content-body">
                        <h2 class="title">{{single_product.product_name}}</h2>
                        <p class="">{{single_product.description}}</p>
                        <div class="rating-star">
                            <span>
                                <i class="fa fa-star{% if single_product.avrageReview < 0.5 %}-o{% elif single_product.avrageReview >= 0.5 and single_product.avrageReview < 1 %}-half-o {% endif %}" aria-hidden="true"></i>
                                <i class="fa fa-star{% if single_product.avrageReview < 1.5 %}-o{% elif single_product.avrageReview >= 1.5 and single_product.avrageReview < 2 %}-half-o {% endif %}" aria-hidden="true"></i>
                                <i class="fa fa-star{% if single_product.avrageReview < 2.5 %}-o{% elif single_product.avrageReview >= 2.5 and single_product.avrageReview < 3 %}-half-o {% endif %}" aria-hidden="true"></i>
                                <i class="fa fa-star{% if single_product.avrageReview < 3.5 %}-o{% elif single_product.avrageReview >= 3.5 and single_product.avrageReview < 4 %}-half-o {% endif %}" aria-hidden="true"></i>
                                <i class="fa fa-star{% if single_product.avrageReview < 4.5 %}-o{% elif single_product.avrageReview >= 4.5 and single_product.avrageReview < 5 %}-half-o {% endif %}" aria-hidden="true"></i>
                                <span> {{single_product.countReview}} reviews</span>
                            </span>
                        </div>
                    
                        <div class="mb-3 py-3"> 
                            <var class="price h4 py-3">Rp. {{single_product.price}}</var> 
                        </div>
                        <p class="">{{single_product.long_description | safe}}</p>
                        

                        <!-- Varian Color -->
                        <!-- <div class="row">
                            <div class="item-option-select">
                                <h6>Choose Color</h6>
                                <select name="color" id="" class="form-control" required>
                                    <option value="" disabled selected>Choose Color</option>
                                    {% for i in single_product.variation_set.colors %}
                                    <option value="{{i.variation_value | lower}}">{{i.variation_value | capfirst}}</option>
                                    {% endfor %}
                                 </select> 
                            </div>
                        </div>  -->
                        <!-- row.// -->
                        
                        <!-- Varian Sizes -->
                        <!-- <div class="row">
                            <div class="item-option-select">
                                <h6>Select Size</h6>
                                <select name="size" id="" class="form-control" required>
                                    <option value="" disabled selected>Select Size</option>
                                    {% for i in single_product.variation_set.sizes %}
                                    <option value="{{i.variation_value | lower}}">{{i.variation_value | capfirst}}</option>
                                    {% endfor %}
                                </select> 
                            </div>
                        </div>     -->
                        <!--  row.// -->
                        <div class="text-center py-3">
                            <a href="{% url 'user_wislist' single_product.id %}" value="add_button" value="{{single_product.id}}"> 
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-suit-heart mr-2" style="color: red;" viewBox="0 0 16 16">
                                    {% if single_product.users_wislist.all %}
                                    <path d="M4 1c2.21 0 4 1.755 4 3.92C8 2.755 9.79 1 12 1s4 1.755 4 3.92c0 3.263-3.234 4.414-7.608 9.608a.513.513 0 0 1-.784 0C3.234 9.334 0 8.183 0 4.92 0 2.755 1.79 1 4 1z"/>
                                    {% else %}
                                    <path d="m8 6.236-.894-1.789c-.222-.443-.607-1.08-1.152-1.595C5.418 2.345 4.776 2 4 2 2.324 2 1 3.326 1 4.92c0 1.211.554 2.066 1.868 3.37.337.334.721.695 1.146 1.093C5.122 10.423 6.5 11.717 8 13.447c1.5-1.73 2.878-3.024 3.986-4.064.425-.398.81-.76 1.146-1.093C14.446 6.986 15 6.131 15 4.92 15 3.326 13.676 2 12 2c-.777 0-1.418.345-1.954.852-.545.515-.93 1.152-1.152 1.595L8 6.236zm.392 8.292a.513.513 0 0 1-.784 0c-1.601-1.902-3.05-3.262-4.243-4.381C1.3 8.208 0 6.989 0 4.92 0 2.755 1.79 1 4 1c1.6 0 2.719 1.05 3.404 2.008.26.365.458.716.596.992a7.55 7.55 0 0 1 .596-.992C9.281 2.049 10.4 1 12 1c2.21 0 4 1.755 4 3.92 0 2.069-1.3 3.288-3.365 5.227-1.193 1.12-2.642 2.48-4.243 4.38z"/>
                                    {% endif %}
                                </svg>
                                <!-- <i class="fas fa-heart mr-3"></i>   -->
                            </a>
                            {% if single_product.stock <= 0 %}
                                <h6 class="text-danger"> Out Of Stock </h6>
                            {% else %}
                                <button type="submit" class="btn  btn-primary"> <span class="text">Add to cart</span> <i class="fas fa-shopping-cart"></i>  </button>
                                <a class="btn btn-outline-primary" href="https://linktr.ee/ar_rasyiid"><i class="fa fa-shopping-cart"></i></i> Buy</a>
                                <a class="btn btn-outline-success" href="http://wa.me/+6281211143508"><i class="fa fa-whatsapp" ></i> Chat</a>
                            {% endif %}
                        </div>
                    </article> <!-- product-info-aside .// -->
                </form>
            </main> <!-- col.// -->
        </div> <!-- row.// -->
    </div> <!-- card.// -->
    <!-- ============================ COMPONENT 1 END .// ================================= -->

    <br><br>
    <!-- Produck Serupa -->
    <h3 class="section-title">Similar Products</h3><br>
    <div class="row col-mb-3">
        {% for obj in products %}
        <div class="col-md-3">
            <div class="card card-product-grid">
                <a href="{{  obj.get_url }}" class="img-wrap"> <img src="{{ obj.images.url }}"> </a>
                <figcaption class="info-wrap">
                    <a href="./product-detail.html" class="title">{{obj.product_name}}</a>
                    <div class="price mt-1">Rp. {{obj.price}}</div> <!-- price-wrap.// -->
                    <div class="rating-star">
                        <span>
                            <i class="fa fa-star{% if obj.avrageReview < 0.5 %}-o{% elif obj.avrageReview >= 0.5 and obj.avrageReview < 1 %}-half-o {% endif %}" aria-hidden="true"></i>
                            <i class="fa fa-star{% if obj.avrageReview < 1.5 %}-o{% elif obj.avrageReview >= 1.5 and obj.avrageReview < 2 %}-half-o {% endif %}" aria-hidden="true"></i>
                            <i class="fa fa-star{% if obj.avrageReview < 2.5 %}-o{% elif obj.avrageReview >= 2.5 and obj.avrageReview < 3 %}-half-o {% endif %}" aria-hidden="true"></i>
                            <i class="fa fa-star{% if obj.avrageReview < 3.5 %}-o{% elif obj.avrageReview >= 3.5 and obj.avrageReview < 4 %}-half-o {% endif %}" aria-hidden="true"></i>
                            <i class="fa fa-star{% if obj.avrageReview < 4.5 %}-o{% elif obj.avrageReview >= 4.5 and obj.avrageReview < 5 %}-half-o {% endif %}" aria-hidden="true"></i>
                        </span>
                    </div>
                </figcaption>
            </div>
        </div> <!-- col.// -->
            
        {% endfor %}
    </div> <!-- row.// -->
    
    <br>
    
    <div class="row">
        <div class="col-md-9">
            <form action="{% url 'submit_review' single_product.id %}" method="POST">
                {% csrf_token %}
                <h5 class="mb-3">Write Your Review</h5>
                <div>
                    <!-- Rating Stars -->
                    <label for="">How do you rate this product?</label>
                    <br>
                    <div class="rate" id="rate">
                        <input type="radio" name="rating" id="rating10" value="5" required ><label for="rating10" title="5"></label>
                        <input type="radio" name="rating" id="rating9" value="4.5" required ><label for="rating9" title="4.5" class="half"></label>
                        <input type="radio" name="rating" id="rating8" value="4" required ><label for="rating8" title="4"></label>
                        <input type="radio" name="rating" id="rating7" value="3.5" required ><label for="rating7" title="3.5" class="half"></label>
                        <input type="radio" name="rating" id="rating6" value="3" required ><label for="rating6" title="3"></label>
                        <input type="radio" name="rating" id="rating5" value="2.5" required ><label for="rating5" title="2.5" class="half"></label>
                        <input type="radio" name="rating" id="rating4" value="2" required ><label for="rating4" title="2"></label>
                        <input type="radio" name="rating" id="rating3" value="1.5" required ><label for="rating3" title="1.5" class="half"></label>
                        <input type="radio" name="rating" id="rating2" value="1" required ><label for="rating2" title="1"></label>
                        <input type="radio" name="rating" id="rating1" value="0.5" required ><label for="rating1" title="0.5" class="half"></label>
                    </div>
                    <br>
                    Review Title: 
                    <input type="text" class="form-control mb-3", name="subject">
                    
                    Review:
                    <textarea name="review" id="" rows="4" class="form-control mb-3"></textarea>
                    <br>
                    {% if user.is_authenticated %}
                        {% if orderproduct %}
                        <input type="submit" value="Submit Review" class="btn btn-sm btn-primary mb-3">
                        {% else %}
                        <p>You must purchase this product a review.</p>
                        {% endif %}
                    {% else %}
                    <p>You must be logged in to post a review. <span><a href="{% url 'login' %}">Login Now</a></span></p>
                    {% endif %}
                </div>
                {% include 'includes/alerts.html' %}
            </form>
            <br>
            <header class="section-heading">
                <h3>Customer Reviews </h3>
                <span>
                    <div class="rating-star">
                        <span>
                            <i class="fa fa-star{% if single_product.avrageReview < 0.5 %}-o{% elif single_product.avrageReview >= 0.5 and single_product.avrageReview < 1 %}-half-o {% endif %}" aria-hidden="true"></i>
                            <i class="fa fa-star{% if single_product.avrageReview < 1.5 %}-o{% elif single_product.avrageReview >= 1.5 and single_product.avrageReview < 2 %}-half-o {% endif %}" aria-hidden="true"></i>
                            <i class="fa fa-star{% if single_product.avrageReview < 2.5 %}-o{% elif single_product.avrageReview >= 2.5 and single_product.avrageReview < 3 %}-half-o {% endif %}" aria-hidden="true"></i>
                            <i class="fa fa-star{% if single_product.avrageReview < 3.5 %}-o{% elif single_product.avrageReview >= 3.5 and single_product.avrageReview < 4 %}-half-o {% endif %}" aria-hidden="true"></i>
                            <i class="fa fa-star{% if single_product.avrageReview < 4.5 %}-o{% elif single_product.avrageReview >= 4.5 and single_product.avrageReview < 5 %}-half-o {% endif %}" aria-hidden="true"></i>
                            <span> {{single_product.countReview}} reviews</span>

                        </span>
                    </div>
                </span>
            </header>
            {% for review in reviews %}
            <article class="box mb-3">
                <div class="icontext w-100">
                    <!-- <img src="{% static './images/avatars/avatar1.jpg' %}" class="img-xs icon rounded-circle"> -->
                    <div class="text">
                        <span class="date text-muted float-md-right">{{review.updated_date}}</span>  
                        <h6 class="mb-1">{{review.user.full_name}} </h6>
                        <div class="rating-star">
                            <span>
                                <i class="fa fa-star{% if review.rating == 0.5 %}-half-o{% elif review.rating < 1 %}-o {% endif %}" aria-hidden="true"></i>
                                <i class="fa fa-star{% if review.rating == 1.5 %}-half-o{% elif review.rating < 2 %}-o {% endif %}" aria-hidden="true"></i>
                                <i class="fa fa-star{% if review.rating == 2.5 %}-half-o{% elif review.rating < 3 %}-o {% endif %}" aria-hidden="true"></i>
                                <i class="fa fa-star{% if review.rating == 3.5 %}-half-o{% elif review.rating < 4 %}-o {% endif %}" aria-hidden="true"></i>
                                <i class="fa fa-star{% if review.rating == 4.5 %}-half-o{% elif review.rating < 5 %}-o {% endif %}" aria-hidden="true"></i>
                            </span>
                        </div>
                    </div>
                </div> <!-- icontext.// -->
                <div class="mt-3">
                    <h6>{{review.subject}}</h6>
                    <p>
                        {{review.review}}
                    </p>	
                </div>
            </article>
            {% endfor %}

        </div> <!-- col.// -->
    </div> <!-- row.// -->

    
    
    
    </div> <!-- container .//  -->
    </section>
    <!-- ========================= SECTION CONTENT END// ========================= -->
    
{% endblock content %}